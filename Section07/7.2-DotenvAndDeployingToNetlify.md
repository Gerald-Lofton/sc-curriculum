# Deploying Your Site To Netlify

## **Objective: -**

In this module we'll look at how to setup a website Frontend on Netlify. We will use out Practice SPA for this exercise.

Deploying to Netlify is a requirement for your capstone project, and you will have to do this with your project as well.

<br>

---

<br>

### **Securing environmental variables with `dotenv`**

So far, this "security" isn't doing us much good if we still have to hard code our API keys/tokens into our JS (which is then pushed to GitHub for all the world to see...).

Luckily, we have a third-party module that can create hidden **environment variables**: [`dotenv`](https://www.npmjs.com/package/dotenv).

1. Install `dotenv`

   ```javascript
   npm install dotenv
   ```

2. Create a `.env` file in the root directory and add our OpenWeatherMap API key and the Pizza place API key to a line:

   ```yaml
   OPEN_WEATHER_MAP_API_KEY=<your OpenWeatherMap API Key here>
   PIZZA_PLACE_API_URL=https://sc-pizza-api.herokuapp.com/pizzas
   ```

   Each line `.env` is for a new variable, and we don't separate our variables with commas or semi-colons. Also, because these are fixed, "hard" variables, we use upper case and snake case (i.e. UPPER_AND_SNAKE_CASE).

3. We never want to give GitHub access to our `.env` file, so we need to add `.env` to our `.gitignore`.

4. To access our environment variables in a JS file, we need to `import` dotenv. Then we can access our environment variables from the `process.env` Object.

    ```javascript
    import dotenv from "dotenv"

    dotenv.config(); // Make sure that dotenv.config(); is placed after all of you import statements

    axios
      .get(`https://api.openweathermap.org/data/2.5/weather?appid=${process.env.OPEN_WEATHER_MAP_API_KEY}&q=st%20louis`)
        .then(response => {
          console.log(response.data);
          done();
        })
        .catch(err => console.log(err));
    ```

    > Read about [Google API key best practices](https://developers.google.com/maps/api-key-best-practices) for more on safeguarding private information.
<br>

At this point, we have successfully connected to an API utilizing authorization and query params, we have secured our API Key with dotenv, and we have saved that data into state so we can access it on our Home page! Since we have also set up the foundation for us to be able to call an additional API, let's implement another API and populate some information on our Pizza page!

---

<br>

### **Activity 5: fetching Pizza data with `Axios` for our SPA**

### Create the Pizza! view and update the `components/views/index.js` file

<br>

1. We need to create a view template file in the `components/views` folder named `Pizza.js` and add the template which will display the list in an HTML table.

    ```javascript
    export default st => `
    <table id="pizzas">
    <tr><th>Crust</th><th>Cheese</th><th>Sauce</th><th>Toppings</th><th>Customer</th></tr>
    ${st.pizzas
      .map(pizza => {
        return `<tr><td>${pizza.crust}</td><td>${pizza.cheese}</td><td>${
          pizza.sauce
        }</td><td>${pizza.toppings.join(" & ")}</td><td>${pizza.customer}</td></tr>`;
      })
      .join("")}

    </table>
    `;

    ```

2. Next we need to add the `Pizza` file to the `components/views/index.js` file so that the view can be retrieved successfully by the SPA.

    ```javascript
    export { default as Pizza } from "./Pizza";
    ```

3. And let's make it look better by adding some styles to the `styles.css` file.

    ```css
    #pizzas {
      font-family: Arial, Helvetica, sans-serif;
      font-size: 1.2em;
      height: auto;
      width: 92.5%;
      margin: auto;
    }

    #pizzas tbody {
      width: 100%;
    }

    #pizzas th {
      text-align: left;
    }

    #pizzas td,th {
      width: 25%;
    }

    ```

Our view is now complete but there is no data to display the view. So, let's add the Pizza! store...

<br>

### Create the Pizza! store and update the `store/index.js` file

<br>

We need to create a store file in the `store` folder named `Pizza.js` and add the JSON object that the SPA expects to be able to display the view.

```javascript
export default {
  header: "List of Pizzas",
  view: "Pizza",
  pizzas: []
};

```

> Note that `pizzas` is initialized as an empty array to reduce the likelihood of an error being produced due to the value being undefined.

<br>

Next we need to add the `Pizza` file to the `store/index.js` file so that the view can be retrieved successfully by the SPA.

```javascript
export { default as Pizza } from "./Pizza";
```

<br>

### Update the navigation to include Pizza!

<br>

As previously discussed we need to update the `store/Links.js` file to include the Pizza! link in the header nav menu by adding the following to the end of the links array.

```javascript
{ title: "Pizza", text: "Pizza!" }
```

> Don't forget to add a comma to the previous object in the array.

<br>

### Update the SPA `index.js` file to retrieve the Pizza! list.

<br>

At the bottom of the `index.js` file let's add to the router.hooks function from earlier.

```javascript
router.hooks({
  before: (done, params) => {
    const view = params && params.data && params.data.view ? capitalize(params.data.view) : "Home";

    // Add a switch case statement to handle multiple routes
    switch (view) {
      case "Home":
        axios
          .get(
            `https://api.openweathermap.org/data/2.5/weather?appid=${process.env.OPEN_WEATHER_MAP_API_KEY}&q=st%20louis`
          )
          .then(response => {
            const kelvinToFahrenheit = kelvinTemp =>
              Math.round((kelvinTemp - 273.15) * (9 / 5) + 32);

            store.Home.weather = {};
            store.Home.weather.city = response.data.name;
            store.Home.weather.temp = kelvinToFahrenheit(response.data.main.temp);
            store.Home.weather.feelsLike = kelvinToFahrenheit(response.data.main.feels_like);
            store.Home.weather.description = response.data.weather[0].main;
            done();
        })
        .catch((err) => {
          console.log(err);
          done();
        });
        break;
      case "Pizza":
        axios
          .get(`${process.env.PIZZA_PLACE_API_URL}`)
          .then(response => {
            store.Pizza.pizzas = response.data;
            done();
          })
          .catch((error) => {
            console.log("It puked", error);
            done();
          });
          break;
      default :
        done();
    }
  }
});

```

> Note: We are only configuring the Pizza view at this point but using the switch allows for future views to be added, and only retrieve the data when the data is needed.

<br>

---
<br>

## 1. Sign-up or log-in to Netlify

<br>

## 2. Click "New site from Git"

![Select "New Site from Git"](img/Netlify_NewSiteFromGit.png)

<br>

## 3. Under "Continuous Deploy" select the GitHub icon

![Select the GitHub icon](img/Netlify_CreateNewSite_ContinuousDeploy1.png)

<br>

## 4. Under "Continuous Deploy: GitHub App" choose your repo

1.  Give Netlify access to your repo(s)
2.  Save
3.  Select a branch (`master`)

![Choose your GitHub repo](img/Netlify_CreateNewSite_ContinuousDeploy2.png)

<br>

## 5. Under "Basic Build setting" configure your deploy settings

    - Enter our build command: `npm run parcel-build`
    - Our publish directory is `./dist`
    - In the advanced settings, we can define our "hidden" environment variables

![Configure your deploy settings](img/Netlify_CreateNewSite_BasicBuildSettings.png)

<br>

## 6. Deploy the site and customize your domain name -- under 'site overview' -> 'site settings' -- while Netlify builds your site.

<br>

## 7. We now have a [live website](https://savvycoders-spa-example.netlify.com/) that anyone can access!

![Savvy Coders Example SAP website](img/SavvyCodersExampleSPA.png)

<br>

### You can read more about Netlify and how to Deploy a Front End Application with Netlify on freeCodeCamp at [https://www.freecodecamp.org/news/how-to-deploy-your-front-end-app/](https://www.freecodecamp.org/news/how-to-deploy-your-front-end-app/).

<br>

---

<br>

### **Summary: -**

In this module we learned how to setup a website Frontend on Netlify.

This process can be a little tricky as Netlify uses a strict environment and throws and error on every tiny issue.

However, once you get your site up and running you can be sure your frontend code base is syntactically error free.
